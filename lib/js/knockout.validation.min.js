!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.validation={})}(function(e,t){function i(e){var t="max"===e;return function(i,r){if(n.utils.isEmptyVal(i))return!0;var a,s;void 0===r.typeAttr?(s="text",a=r):(s=r.typeAttr,a=r.value),isNaN(a)||(s="number");var u,o,l;switch(s.toLowerCase()){case"week":if(u=/^(\d{4})-W(\d{2})$/,o=i.match(u),null===o)throw"Invalid value for "+e+" attribute for week input.  Should look like '2000-W33' http://www.w3.org/TR/html-markup/input.week.html#input.week.attrs.min";return l=a.match(u),l?t?o[1]<l[1]||o[1]===l[1]&&o[2]<=l[2]:o[1]>l[1]||o[1]===l[1]&&o[2]>=l[2]:!1;case"month":if(u=/^(\d{4})-(\d{2})$/,o=i.match(u),null===o)throw"Invalid value for "+e+" attribute for month input.  Should look like '2000-03' http://www.w3.org/TR/html-markup/input.month.html#input.month.attrs.min";return l=a.match(u),l?t?o[1]<l[1]||o[1]===l[1]&&o[2]<=l[2]:o[1]>l[1]||o[1]===l[1]&&o[2]>=l[2]:!1;case"number":case"range":return t?!isNaN(i)&&parseFloat(i)<=parseFloat(a):!isNaN(i)&&parseFloat(i)>=parseFloat(a);default:return t?a>=i:i>=a}}}function r(e,t,i){return t.validator(e(),void 0===i.params?!0:u(i.params))?!0:(e.setError(n.formatMessage(i.message||t.message,u(i.params),e)),!1)}function a(e,t,i){e.isValidating(!0);var r=function(r){var a=!1,s="";return e.__valid__()?(r.message?(a=r.isValid,s=r.message):a=r,a||(e.error(n.formatMessage(s||i.message||t.message,u(i.params),e)),e.__valid__(a)),void e.isValidating(!1)):void e.isValidating(!1)};t.validator(e(),u(i.params||!0),r)}if(void 0===typeof e)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";e.validation=t;var n=e.validation,s=e.utils,u=s.unwrapObservable,o=s.arrayForEach,l=s.extend,d={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateInputElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",allowHtmlMessages:!1,grouping:{deep:!1,observable:!0,live:!1},validate:{}},f=l({},d);f.html5Attributes=["required","pattern","min","max","step"],f.html5InputTypes=["email","number","date"],f.reset=function(){l(f,d)},n.configuration=f,n.utils=function(){var e=(new Date).getTime(),t={},i="__ko_validation__";return{isArray:function(e){return e.isArray||"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return null!==e&&"object"==typeof e},isObservableArray:function(e){return!!e&&"function"==typeof e.remove&&"function"==typeof e.removeAll&&"function"==typeof e.destroy&&"function"==typeof e.destroyAll&&"function"==typeof e.indexOf&&"function"==typeof e.replace},values:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t},getValue:function(e){return"function"==typeof e?e():e},hasAttribute:function(e,t){return null!==e.getAttribute(t)},getAttribute:function(e,t){return e.getAttribute(t)},setAttribute:function(e,t,i){return e.setAttribute(t,i)},isValidatable:function(e){return!!(e&&e.rules&&e.isValid&&e.isModified)},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},newId:function(){return e+=1},getConfigOptions:function(e){var t=n.utils.contextFor(e);return t||n.configuration},setDomData:function(e,r){var a=e[i];a||(e[i]=a=n.utils.newId()),t[a]=r},getDomData:function(e){var r=e[i];return r?t[r]:void 0},contextFor:function(e){switch(e.nodeType){case 1:case 8:var t=n.utils.getDomData(e);if(t)return t;if(e.parentNode)return n.utils.contextFor(e.parentNode)}return void 0},isEmptyVal:function(e){return void 0===e?!0:null===e?!0:""===e?!0:void 0},getOriginalElementTitle:function(e){var t=n.utils.getAttribute(e,"data-orig-title"),i=e.title,r=n.utils.hasAttribute(e,"data-orig-title");return r?t:i},async:function(e){window.setImmediate?window.setImmediate(e):window.setTimeout(e,0)},forEach:function(e,t){if(n.utils.isArray(e))return o(e,t);for(var i in e)e.hasOwnProperty(i)&&t(e[i],i)}}}();var c=function(){function t(e){o(e.subscriptions,function(e){e.dispose()}),e.subscriptions=[]}function i(e){e.options.deep&&(o(e.flagged,function(e){delete e.__kv_traversed}),e.flagged.length=0),e.options.live||t(e)}function r(e,r){r.validatables=[],t(r),a(e,r),i(r)}function a(t,i,r){var n=[],s=t.peek?t.peek():t;t.__kv_traversed!==!0&&(i.options.deep&&(t.__kv_traversed=!0,i.flagged.push(t)),r=void 0!==r?r:i.options.deep?1:-1,e.isObservable(t)&&(t.isValid||t.extend({validatable:!0}),i.validatables.push(t),i.options.live&&p.isObservableArray(t)&&i.subscriptions.push(t.subscribe(function(){i.graphMonitor.valueHasMutated()}))),s&&!s._destroy&&(p.isArray(s)?n=s:p.isObject(s)&&(n=p.values(s))),0!==r&&p.forEach(n,function(e){e&&!e.nodeType&&a(e,i,r+1)}))}function d(e){var t=[];return o(e,function(e){e.isValid()||t.push(e.error())}),t}var f=0,c=n.configuration,p=n.utils;return{init:function(e,t){f>0&&!t||(e=e||{},e.errorElementClass=e.errorElementClass||e.errorClass||c.errorElementClass,e.errorMessageClass=e.errorMessageClass||e.errorClass||c.errorMessageClass,l(c,e),c.registerExtenders&&n.registerExtenders(),f=1)},configure:function(e){n.init(e)},reset:n.configuration.reset,group:function(t,i){i=l(l({},c.grouping),i);var a={options:i,graphMonitor:e.observable(),flagged:[],subscriptions:[],validatables:[]},n=null;return i.observable?(r(t,a),n=e.computed(function(){return a.graphMonitor(),r(t,a),d(a.validatables)})):n=function(){return r(t,a),d(a.validatables)},n.showAllMessages=function(e){void 0===e&&(e=!0),n(),o(a.validatables,function(t){t.isModified(e)})},t.errors=n,t.isValid=function(){return 0===t.errors().length},t.isAnyMessageShown=function(){var e=!1;return n(),e=!!s.arrayFirst(a.validatables,function(e){return!e.isValid()&&e.isModified()})},n},formatMessage:function(e,t,i){return"function"==typeof e?e(t,i):e.replace(/\{0\}/gi,u(t))},addRule:function(e,t){return e.extend({validatable:!0}),e.rules.push(t),e},addAnonymousRule:function(e,t){void 0===t.message&&(t.message="Error"),t.onlyIf&&(t.condition=t.onlyIf),n.addRule(e,t)},addExtender:function(t){e.extenders[t]=function(e,i){return i&&(i.message||i.onlyIf)?n.addRule(e,{rule:t,message:i.message,params:p.isEmptyVal(i.params)?!0:i.params,condition:i.onlyIf}):n.addRule(e,{rule:t,params:i})}},registerExtenders:function(){if(c.registerExtenders)for(var t in n.rules)n.rules.hasOwnProperty(t)&&(e.extenders[t]||n.addExtender(t))},insertValidationMessage:function(e){var t=document.createElement("SPAN");return t.className=p.getConfigOptions(e).errorMessageClass,p.insertAfter(e,t),t},parseInputValidationAttributes:function(e,t){o(n.configuration.html5Attributes,function(i){if(p.hasAttribute(e,i)){var r=e.getAttribute(i)||!0;if("min"===i||"max"===i){var a=e.getAttribute("type");"undefined"!=typeof a&&a||(a="text"),r={typeAttr:a,value:r}}n.addRule(t(),{rule:i,params:r})}});var i=e.getAttribute("type");o(n.configuration.html5InputTypes,function(e){e===i&&n.addRule(t(),{rule:"date"===e?"dateISO":e,params:!0})})},writeInputValidationAttributes:function(e,t){var i=t();if(i&&i.rules){var r=i.rules();o(n.configuration.html5Attributes,function(t){var i,a=s.arrayFirst(r,function(e){return e.rule.toLowerCase()===t.toLowerCase()});a&&(i=a.params,"pattern"===a.rule&&a.params instanceof RegExp&&(i=a.params.source),e.setAttribute(t,i))}),r=null}},makeBindingHandlerValidatable:function(t){var i=e.bindingHandlers[t].init;e.bindingHandlers[t].init=function(t,r,a,n,s){return i(t,r,a,n,s),e.bindingHandlers.validationCore.init(t,r,a,n,s)}},setRules:function(t,i){var r=function(t,i){if(t&&i)for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];if(t[a]){var o=t[a],l=u(o),d={},f={};for(var c in s)s.hasOwnProperty(c)&&(n.rules[c]?d[c]=s[c]:f[c]=s[c]);if(e.isObservable(o)&&o.extend(d),l&&p.isArray(l))for(var v=0;v<l.length;v++)r(l[v],f);else r(l,f)}}};r(t,i)}}}();l(e.validation,c),n.rules={},n.rules.required={validator:function(e,t){var i,r=/^\s+|\s+$/g;return void 0===e||null===e?!t:(i=e,"string"==typeof e&&(i=e.replace(r,"")),t?(i+"").length>0:!0)},message:"{0}."},n.rules.min={validator:i("min"),message:"Please enter a value greater than or equal to {0}."},n.rules.max={validator:i("max"),message:"Please enter a value less than or equal to {0}."},n.rules.minLength={validator:function(e,t){return n.utils.isEmptyVal(e)||e.length>=t},message:"Please enter at least {0} characters."},n.rules.maxLength={validator:function(e,t){return n.utils.isEmptyVal(e)||e.length<=t},message:"Please enter no more than {0} characters."},n.rules.pattern={validator:function(e,t){return n.utils.isEmptyVal(e)||null!==e.toString().match(t)},message:"Please check this value."},n.rules.step={validator:function(e,t){if(n.utils.isEmptyVal(e)||"any"===t)return!0;var i=100*e%(100*t);return Math.abs(i)<1e-5||Math.abs(1-i)<1e-5},message:"The value must increment by {0}"},n.rules.email={validator:function(e,t){return t?n.utils.isEmptyVal(e)||t&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e):!0},message:"Please enter a proper email address"},n.rules.date={validator:function(e,t){return t?n.utils.isEmptyVal(e)||t&&!/Invalid|NaN/.test(new Date(e)):!0},message:"Please enter a proper date"},n.rules.dateISO={validator:function(e,t){return t?n.utils.isEmptyVal(e)||t&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(e):!0},message:"Please enter a proper date"},n.rules.number={validator:function(e,t){return t?n.utils.isEmptyVal(e)||t&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e):!0},message:"Please enter a number"},n.rules.digit={validator:function(e,t){return t?n.utils.isEmptyVal(e)||t&&/^\d+$/.test(e):!0},message:"Please enter a digit"},n.rules.phoneUS={validator:function(e,t){return t?n.utils.isEmptyVal(e)?!0:"string"!=typeof e?!1:(e=e.replace(/\s+/g,""),t&&e.length>9&&e.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number"},n.rules.equal={validator:function(e,t){var i=t;return e===n.utils.getValue(i)},message:"Values must equal"},n.rules.notEqual={validator:function(e,t){var i=t;return e!==n.utils.getValue(i)},message:"Please choose another value."},n.rules.unique={validator:function(e,t){var i=n.utils.getValue(t.collection),r=n.utils.getValue(t.externalValue),a=0;return e&&i?(s.arrayFilter(i,function(i){e===(t.valueAccessor?t.valueAccessor(i):i)&&a++}),(r?1:2)>a):!0},message:"Please make sure the value is unique."},function(){n.registerExtenders()}(),e.bindingHandlers.validationCore=function(){return{init:function(t,i){var r=n.utils.getConfigOptions(t),a=i();if(r.parseInputAttributes&&n.utils.async(function(){n.parseInputValidationAttributes(t,i)}),r.insertMessages&&n.utils.isValidatable(a)){var s=n.insertValidationMessage(t);r.messageTemplate?e.renderTemplate(r.messageTemplate,{field:a},null,s,"replaceNode"):e.applyBindingsToNode(s,{validationMessage:a})}r.writeInputAttributes&&n.utils.isValidatable(a)&&n.writeInputValidationAttributes(t,i),r.decorateInputElement&&n.utils.isValidatable(a)&&e.applyBindingsToNode(t,{validationElement:a})}}}(),n.makeBindingHandlerValidatable("value"),n.makeBindingHandlerValidatable("checked"),e.bindingHandlers.validationMessage={update:function(t,i){var r=i(),a=n.utils.getConfigOptions(t),o=(u(r),!1),l=!1;if(!r.isValid||!r.isModified)throw new Error("Observable is not validatable");o=r.isModified(),l=r.isValid();var d=null;(!a.messagesOnModified||o)&&(d=l?null:r.error);var f=!a.messagesOnModified||o?!l:!1,c="none"!==t.style.display;a.allowHtmlMessages?s.setHtml(t,d):e.bindingHandlers.text.update(t,function(){return d}),c&&!f?t.style.display="none":!c&&f&&(t.style.display="")}},e.bindingHandlers.validationElement={update:function(t,i,r){var a=i(),s=n.utils.getConfigOptions(t),o=(u(a),!1),l=!1;if(!a.isValid||!a.isModified)throw new Error("Observable is not validatable");o=a.isModified(),l=a.isValid();var d=function(){var e={},t=!s.decorateElementOnModified||o?!l:!1;return e[s.errorElementClass]=t,e};e.bindingHandlers.css.update(t,d,r),s.errorsAsTitle&&e.bindingHandlers.attr.update(t,function(){var e=!s.errorsAsTitleOnModified||o,i=n.utils.getOriginalElementTitle(t);return e&&!l?{title:a.error,"data-orig-title":i}:!e||l?{title:i,"data-orig-title":null}:void 0})}},e.bindingHandlers.validationOptions=function(){return{init:function(e,t){var i=u(t());if(i){var r=l({},n.configuration);l(r,i),n.utils.setDomData(e,r)}}}}(),e.extenders.validation=function(e,t){return o(n.utils.isArray(t)?t:[t],function(t){n.addAnonymousRule(e,t)}),e},e.extenders.validatable=function(t,i){if(n.utils.isObject(i)||(i={enable:i}),"enable"in i||(i.enable=!0),i.enable&&!n.utils.isValidatable(t)){var r=n.configuration.validate||{},a={throttleEvaluation:i.throttle||r.throttle};t.error=e.observable(null),t.rules=e.observableArray(),t.isValidating=e.observable(!1),t.__valid__=e.observable(!0),t.isModified=e.observable(!1),t.isValid=e.computed(t.__valid__),t.setError=function(e){t.error(e),t.__valid__(!1)},t.clearError=function(){return t.error(null),t.__valid__(!0),t};var s=t.subscribe(function(){t.isModified(!0)}),u=e.computed(l({read:function(){t(),t.rules();return n.validateObservable(t),!0}},a));l(u,a),t._disposeValidation=function(){t.isValid.dispose(),t.rules.removeAll(),t.isModified.getSubscriptionsCount()>0&&(t.isModified._subscriptions.change=[]),t.isValidating.getSubscriptionsCount()>0&&(t.isValidating._subscriptions.change=[]),t.__valid__.getSubscriptionsCount()>0&&(t.__valid__._subscriptions.change=[]),s.dispose(),u.dispose(),delete t.rules,delete t.error,delete t.isValid,delete t.isValidating,delete t.__valid__,delete t.isModified}}else i.enable===!1&&t._disposeValidation&&t._disposeValidation();return t},n.validateObservable=function(e){for(var t,i,s=0,u=e.rules(),o=u.length;o>s;s++)if(i=u[s],!i.condition||i.condition())if(t=i.rule?n.rules[i.rule]:i,t.async||i.async)a(e,t,i);else if(!r(e,t,i))return!1;return e.clearError(),!0},n.localize=function(e){var t;for(t in e)n.rules.hasOwnProperty(t)&&(n.rules[t].message=e[t])},e.applyBindingsWithValidation=function(t,i,r){var a,s,u=arguments.length;u>2?(a=i,s=r):2>u?a=document.body:arguments[1].nodeType?a=i:s=arguments[1],n.init(),s&&n.utils.setDomData(a,s),e.applyBindings(t,i)};var p=e.applyBindings;e.applyBindings=function(e,t){n.init(),p(e,t)},e.validatedObservable=function(t){if(!n.utils.isObject(t))return e.observable(t).extend({validatable:!0});var i=e.observable(t);return i.isValid=e.observable(),i.errors=n.group(t),i.errors.subscribe(function(e){i.isValid(0===e.length)}),i}});